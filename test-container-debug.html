<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>容器调试测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .container-test {
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 10px 0;
            min-height: 100px;
        }
        .container-found {
            border-color: #52c41a;
            background: #f6ffed;
        }
        .container-missing {
            border-color: #ff4d4f;
            background: #fff2f0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            border-radius: 4px;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #40a9ff;
        }
    </style>
</head>
<body>
    <h1>Qiankun 容器调试工具</h1>
    
    <div class="debug-panel">
        <h3>容器状态检查</h3>
        <button onclick="checkContainers()">检查所有容器</button>
        <button onclick="createTestContainer()">创建测试容器</button>
        <button onclick="clearLog()">清空日志</button>
        
        <div id="container-status"></div>
    </div>

    <div class="debug-panel">
        <h3>测试容器</h3>
        <div id="micro-app-react-user-management" class="container-test">
            <p>容器 ID: micro-app-react-user-management</p>
            <p>这是测试用的微应用容器</p>
        </div>
    </div>

    <div class="debug-panel">
        <h3>实时日志</h3>
        <div id="log" class="log">等待操作...</div>
    </div>

    <script>
        const log = document.getElementById('log');
        const containerStatus = document.getElementById('container-status');
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            log.textContent = '';
        }
        
        function checkContainers() {
            addLog('开始检查容器状态...');
            
            const expectedContainers = [
                '#micro-app-react-user-management',
                '#micro-app-react-product-management',
                '#micro-app-react-order-management',
                '#micro-app-react-dashboard',
                '#micro-app-react-settings',
                '#micro-app-vue-message-center',
                '#micro-app-vue-file-management',
                '#micro-app-vue-system-monitor'
            ];
            
            let statusHTML = '<h4>容器检查结果:</h4>';
            
            expectedContainers.forEach(containerSelector => {
                const container = document.querySelector(containerSelector);
                const exists = !!container;
                const containerId = containerSelector.replace('#', '');
                
                addLog(`检查容器: ${containerSelector} - ${exists ? '✓ 存在' : '✗ 不存在'}`);
                
                if (exists) {
                    const rect = container.getBoundingClientRect();
                    addLog(`  容器信息: ID=${container.id}, 类名=${container.className}, 尺寸=${rect.width}x${rect.height}`);
                    statusHTML += `<div class="container-test container-found">
                        ✓ ${containerSelector} - 存在
                        <br>ID: ${container.id}
                        <br>类名: ${container.className}
                        <br>尺寸: ${rect.width}x${rect.height}
                    </div>`;
                } else {
                    statusHTML += `<div class="container-test container-missing">
                        ✗ ${containerSelector} - 不存在
                    </div>`;
                }
            });
            
            // 检查所有带有 micro-app 的元素
            const allMicroElements = document.querySelectorAll('[id*="micro-app"]');
            addLog(`找到 ${allMicroElements.length} 个包含 'micro-app' 的元素:`);
            
            allMicroElements.forEach(el => {
                addLog(`  - ID: ${el.id}, 标签: ${el.tagName}, 类名: ${el.className}`);
            });
            
            containerStatus.innerHTML = statusHTML;
            addLog('容器检查完成');
        }
        
        function createTestContainer() {
            addLog('创建测试容器...');
            
            // 创建一个新的测试容器
            const testContainer = document.createElement('div');
            testContainer.id = 'micro-app-test-dynamic';
            testContainer.className = 'container-test container-found';
            testContainer.innerHTML = '<p>动态创建的测试容器</p><p>ID: micro-app-test-dynamic</p>';
            
            document.body.appendChild(testContainer);
            addLog('✓ 动态测试容器已创建: #micro-app-test-dynamic');
            
            // 立即检查是否能找到
            setTimeout(() => {
                const found = document.querySelector('#micro-app-test-dynamic');
                addLog(`验证动态容器: ${found ? '✓ 找到' : '✗ 未找到'}`);
            }, 100);
        }
        
        // 监听DOM变化
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1 && node.id && node.id.includes('micro-app')) {
                            addLog(`DOM变化: 添加了容器 #${node.id}`);
                        }
                    });
                    
                    mutation.removedNodes.forEach(function(node) {
                        if (node.nodeType === 1 && node.id && node.id.includes('micro-app')) {
                            addLog(`DOM变化: 移除了容器 #${node.id}`);
                        }
                    });
                }
                
                if (mutation.type === 'attributes' && mutation.attributeName === 'id') {
                    const target = mutation.target;
                    if (target.id && target.id.includes('micro-app')) {
                        addLog(`DOM变化: 容器ID属性变更 #${target.id}`);
                    }
                }
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['id']
        });
        
        // 页面加载完成后自动检查
        window.addEventListener('load', function() {
            addLog('页面加载完成，开始自动检查...');
            setTimeout(checkContainers, 1000);
        });
        
        addLog('调试工具已准备就绪');
    </script>
</body>
</html>